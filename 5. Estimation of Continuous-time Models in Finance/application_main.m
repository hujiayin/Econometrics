data = rmmissing(RIFLGFCM01_NB);
plot(data)
n = length(data);
Xs_data = data(1:n-1,1);
X_data = data(2:n,1);

% MLE using actual density function
gv = @(x, xs, theta) exp((theta(1)*(x - theta(2) + exp(-theta(1)/250)*(theta(2) - xs)).^2)/(theta(3).^2*(exp(-theta(1)/125) - 1)))/(-(theta(3).^2*pi*(exp(-theta(1)/125) - 1))/theta(1)).^(1/2)
[y, fval, ste, p_value] = mle(gv, X_data, Xs_data, [1, 1, 1])

% MLE using transition density function
f = @(x, xs, theta) -(2251799813685248.*250.^(1/2).*exp(-(125.*(x - xs).^2)/theta(3).^2).*((250.*((theta(1).^3.*(7.*theta(1).*theta(2).^2 - 14.*theta(1).*theta(2).*xs - 4.*theta(3).^2 + 7.*theta(1).*xs.^2))/(375000000.*theta(3).^2) - (theta(1).^2.*(3.*theta(1).*theta(2).^2 - 6.*theta(1).*theta(2).*xs - 2.*theta(3).^2 + 3.*theta(1).*xs.^2))/(375000.*theta(3).^2) + (theta(1).*(theta(1).*theta(2).^2 - 2.*theta(1).*theta(2).*xs - theta(3).^2 + theta(1).*xs.^2))/(500.*theta(3).^2)).*(theta(3).^2/250 - x.^2 + 2.*x.*xs - xs.^2))/theta(3).^2 + (theta(1).*(theta(2) - xs).*(x - xs).*(theta(1).^3/15625000 - theta(1).^2/15625 + (6.*theta(1))/125 - 24))/(24.*theta(3).^2) - 1))/(5644425081792261.*theta(3))
[y, fval, ste, p_value] = mle(f, X_data, Xs_data, [1, 1, 1])

g_cev = @(x, xs, theta) (2251799813685248.*250.^(1/2).*exp(-(125.*(x.*xs.^theta(4) - x.^theta(4).*xs).^2)/(theta(3).^2.*x.^(2.*theta(4)).*xs.^(2.*theta(4)).*(theta(4) - 1).^2)).*((250.^(1/2).*(x.*xs.^theta(4) - x.^theta(4).*xs).*((((theta(3).*theta(4).*exp(-xs.^(1 - theta(4))/(theta(4) - 1)).^(theta(4) - 1))/2 - (theta(1).*(theta(2) - exp(-xs/(xs.^theta(4).*(theta(4) - 1)))))/(theta(3).*exp(-xs.^(- theta(4) + 1)/(theta(4) - 1)).^theta(4))).*((250.^(1/2).*((2.*theta(1).*exp(-xs/(xs.^theta(4).*(theta(4) - 1))))/exp(-xs.^(- theta(4) + 1)/(theta(4) - 1)).^theta(4) + (2.*theta(1).*theta(4).*(theta(2) - exp(-xs/(xs.^theta(4).*(theta(4) - 1)))))/exp(-xs.^(- theta(4) + 1)/(theta(4) - 1)).^theta(4) + theta(3).^2.*theta(4).*exp(-xs.^(1 - theta(4))/(theta(4) - 1)).^(theta(4) - 1).*(theta(4) - 1)).^2)/4 - (250.^(1/2).*(3.*theta(3).^4.*theta(4).^2.*exp(-xs/(xs.^theta(4).*(theta(4) - 1))).^(2.*theta(4)) - 3.*theta(3).^4.*theta(4).^3.*exp(-xs/(xs.^theta(4).*(theta(4) - 1))).^(2.*theta(4)) + theta(3).^4.*theta(4).^4.*exp(-xs/(xs.^theta(4).*(theta(4) - 1))).^(2.*theta(4)) + 2.*theta(1).*theta(3).^2.*exp(-(2.*xs.^(1 - theta(4)))/(theta(4) - 1)) - theta(3).^4.*theta(4).*exp(-xs/(xs.^theta(4).*(theta(4) - 1))).^(2.*theta(4)) + 6.*theta(1).*theta(3).^2.*theta(4).^2.*exp(-(2.*xs.^(1 - theta(4)))/(theta(4) - 1)) - 2.*theta(1).*theta(3).^2.*theta(4).^3.*exp(-(2.*xs.^(1 - theta(4)))/(theta(4) - 1)) - 6.*theta(1).*theta(3).^2.*theta(4).*exp(-(2.*xs.^(1 - theta(4)))/(theta(4) - 1)) + 2.*theta(1).*theta(2).*theta(3).^2.*theta(4).^3.*exp(-xs/(xs.^theta(4).*(theta(4) - 1)))))/(4.*exp(-xs/(xs.^theta(4).*(theta(4) - 1))).^(theta(4) + 1)) + 250.^(1/2).*((theta(3).*theta(4).*exp(-xs.^(1 - theta(4))/(theta(4) - 1)).^(theta(4) - 1))/2 - (theta(1).*(theta(2) - exp(-xs/(xs.^theta(4).*(theta(4) - 1)))))/(theta(3).*exp(-xs.^(- theta(4) + 1)/(theta(4) - 1)).^theta(4))).*((theta(1).*theta(3).*exp(-xs/(xs.^theta(4).*(theta(4) - 1))))/exp(-xs.^(- theta(4) + 1)/(theta(4) - 1)).^theta(4) + (theta(3).^3.*theta(4).*exp(-xs.^(1 - theta(4))/(theta(4) - 1)).^(theta(4) - 1).*(theta(4) - 1))/2 + (theta(1).*theta(3).*theta(4).*(theta(2) - exp(-xs/(xs.^theta(4).*(theta(4) - 1)))))/exp(-xs.^(- theta(4) + 1)/(theta(4) - 1)).^theta(4) - (2.*theta(1).*theta(3).*theta(4).*exp(-(2.*xs.^(1 - theta(4)))/(theta(4) - 1)))/exp(-xs.^(- theta(4) + 1)/(theta(4) - 1)).^(theta(4) + 1) + (theta(3).^3.*theta(4).*exp(-(2.*xs.^(1 - theta(4)))/(theta(4) - 1)).*exp(-xs.^(1 - theta(4))/(theta(4) - 1)).^(theta(4) - 3).*(theta(4) - 1).*(theta(4) - 2))/2 - (theta(1).*theta(3).*theta(4).*exp(-(2.*xs.^(1 - theta(4)))/(theta(4) - 1)).*(theta(2) - exp(-xs/(xs.^theta(4).*(theta(4) - 1)))).*(theta(4) + 1))/exp(-xs.^(- theta(4) + 1)/(theta(4) - 1)).^(theta(4) + 2))))/93750000 + (250.^(1/2).*((theta(1).*theta(3).*exp(-xs/(xs.^theta(4).*(theta(4) - 1))))/(4.*exp(-xs.^(- theta(4) + 1)/(theta(4) - 1)).^theta(4)) + (theta(3).^3.*theta(4).*exp(-xs.^(1 - theta(4))/(theta(4) - 1)).^(theta(4) - 1).*(theta(4) - 1))/8 + (theta(1).*theta(3).*theta(4).*(theta(2) - exp(-xs/(xs.^theta(4).*(theta(4) - 1)))))/(4.*exp(-xs.^(- theta(4) + 1)/(theta(4) - 1)).^theta(4)) - (theta(1).*theta(3).*theta(4).*exp(-(2.*xs.^(1 - theta(4)))/(theta(4) - 1)))/(2.*exp(-xs.^(- theta(4) + 1)/(theta(4) - 1)).^(theta(4) + 1)) + (theta(3).^3.*theta(4).*exp(-(2.*xs.^(1 - theta(4)))/(theta(4) - 1)).*exp(-xs.^(1 - theta(4))/(theta(4) - 1)).^(theta(4) - 3).*(theta(4) - 1).*(theta(4) - 2))/8 - (theta(1).*theta(3).*theta(4).*exp(-(2.*xs.^(1 - theta(4)))/(theta(4) - 1)).*(theta(2) - exp(-xs/(xs.^theta(4).*(theta(4) - 1)))).*(theta(4) + 1))/(4.*exp(-xs.^(- theta(4) + 1)/(theta(4) - 1)).^(theta(4) + 2))))/62500 + (250.^(1/2).*((theta(3).*theta(4).*exp(-xs.^(1 - theta(4))/(theta(4) - 1)).^(theta(4) - 1))/2 - (theta(1).*(theta(2) - exp(-xs/(xs.^theta(4).*(theta(4) - 1)))))/(theta(3).*exp(-xs.^(- theta(4) + 1)/(theta(4) - 1)).^theta(4))))/250 - (250.^(1/2).*((theta(1).*exp(-xs/(xs.^theta(4).*(theta(4) - 1))))/exp(-xs.^(- theta(4) + 1)/(theta(4) - 1)).^theta(4) + (theta(1).*theta(4).*(theta(2) - exp(-xs/(xs.^theta(4).*(theta(4) - 1)))))/exp(-xs.^(- theta(4) + 1)/(theta(4) - 1)).^theta(4) + (theta(3).^2.*theta(4).*exp(-xs.^(1 - theta(4))/(theta(4) - 1)).^(theta(4) - 1).*(theta(4) - 1))/2).*((theta(1).*theta(3).*exp(-xs/(xs.^theta(4).*(theta(4) - 1))))/exp(-xs.^(- theta(4) + 1)/(theta(4) - 1)).^theta(4) + (theta(3).^3.*theta(4).*exp(-xs.^(1 - theta(4))/(theta(4) - 1)).^(theta(4) - 1).*(theta(4) - 1))/2 + (theta(1).*theta(3).*theta(4).*(theta(2) - exp(-xs/(xs.^theta(4).*(theta(4) - 1)))))/exp(-xs.^(- theta(4) + 1)/(theta(4) - 1)).^theta(4) - (2.*theta(1).*theta(3).*theta(4).*exp(-(2.*xs.^(1 - theta(4)))/(theta(4) - 1)))/exp(-xs.^(- theta(4) + 1)/(theta(4) - 1)).^(theta(4) + 1) + (theta(3).^3.*theta(4).*exp(-(2.*xs.^(1 - theta(4)))/(theta(4) - 1)).*exp(-xs.^(1 - theta(4))/(theta(4) - 1)).^(theta(4) - 3).*(theta(4) - 1).*(theta(4) - 2))/2 - (theta(1).*theta(3).*theta(4).*exp(-(2.*xs.^(1 - theta(4)))/(theta(4) - 1)).*(theta(2) - exp(-xs/(xs.^theta(4).*(theta(4) - 1)))).*(theta(4) + 1))/exp(-xs.^(- theta(4) + 1)/(theta(4) - 1)).^(theta(4) + 2)))/62500000 + (250.^(1/2).*(6.*theta(3).^5.*theta(4).^3.*exp(-xs/(xs.^theta(4).*(theta(4) - 1))).^(2.*theta(4)) - 4.*theta(3).^5.*theta(4).^2.*exp(-xs/(xs.^theta(4).*(theta(4) - 1))).^(2.*theta(4)) - 4.*theta(3).^5.*theta(4).^4.*exp(-xs/(xs.^theta(4).*(theta(4) - 1))).^(2.*theta(4)) + theta(3).^5.*theta(4).^5.*exp(-xs/(xs.^theta(4).*(theta(4) - 1))).^(2.*theta(4)) + 2.*theta(1).*theta(3).^3.*exp(-(2.*xs.^(1 - theta(4)))/(theta(4) - 1)) + theta(3).^5.*theta(4).*exp(-xs/(xs.^theta(4).*(theta(4) - 1))).^(2.*theta(4)) + 12.*theta(1).*theta(3).^3.*theta(4).^2.*exp(-(2.*xs.^(1 - theta(4)))/(theta(4) - 1)) - 8.*theta(1).*theta(3).^3.*theta(4).^3.*exp(-(2.*xs.^(1 - theta(4)))/(theta(4) - 1)) + 2.*theta(1).*theta(3).^3.*theta(4).^4.*exp(-(2.*xs.^(1 - theta(4)))/(theta(4) - 1)) - 8.*theta(1).*theta(3).^3.*theta(4).*exp(-(2.*xs.^(1 - theta(4)))/(theta(4) - 1)) - 2.*theta(1).*theta(2).*theta(3).^3.*theta(4).^4.*exp(-xs/(xs.^theta(4).*(theta(4) - 1)))))/(750000000.*exp(-xs/(xs.^theta(4).*(theta(4) - 1))).^(theta(4) + 1)) - (250.^(1/2).*((theta(3).*theta(4).*exp(-xs.^(1 - theta(4))/(theta(4) - 1)).^(theta(4) - 1))/2 - (theta(1).*(theta(2) - exp(-xs/(xs.^theta(4).*(theta(4) - 1)))))/(theta(3).*exp(-xs.^(- theta(4) + 1)/(theta(4) - 1)).^theta(4))).*((theta(1).*exp(-xs/(xs.^theta(4).*(theta(4) - 1))))/exp(-xs.^(- theta(4) + 1)/(theta(4) - 1)).^theta(4) + (theta(1).*theta(4).*(theta(2) - exp(-xs/(xs.^theta(4).*(theta(4) - 1)))))/exp(-xs.^(- theta(4) + 1)/(theta(4) - 1)).^theta(4) + (theta(3).^2.*theta(4).*exp(-xs.^(1 - theta(4))/(theta(4) - 1)).^(theta(4) - 1).*(theta(4) - 1))/2))/125000 - (250.^(1/2).*((theta(3).*theta(4).*exp(-xs.^(1 - theta(4))/(theta(4) - 1)).^(theta(4) - 1))/2 - (theta(1).*(theta(2) - exp(-xs/(xs.^theta(4).*(theta(4) - 1)))))/(theta(3).*exp(-xs.^(- theta(4) + 1)/(theta(4) - 1)).^theta(4))).*((theta(3).^4.*theta(4).*exp(-xs.^(1 - theta(4))/(theta(4) - 1)).^(theta(4) - 1).*(theta(4) - 1))/2 + (theta(1).*theta(3).^2.*exp(-xs/(xs.^theta(4).*(theta(4) - 1))))/exp(-xs.^(- theta(4) + 1)/(theta(4) - 1)).^theta(4) + (theta(1).*theta(3).^2.*theta(4).*(theta(2) - exp(-xs/(xs.^theta(4).*(theta(4) - 1)))))/exp(-xs.^(- theta(4) + 1)/(theta(4) - 1)).^theta(4) - (6.*theta(1).*theta(3).^2.*theta(4).*exp(-(2.*xs.^(1 - theta(4)))/(theta(4) - 1)))/exp(-xs.^(- theta(4) + 1)/(theta(4) - 1)).^(theta(4) + 1) + (3.*theta(1).*theta(3).^2.*theta(4).*exp(-(3.*xs.^(1 - theta(4)))/(theta(4) - 1)).*(theta(4) + 1))/exp(-xs.^(- theta(4) + 1)/(theta(4) - 1)).^(theta(4) + 2) + (3.*theta(3).^4.*theta(4).*exp(-(2.*xs.^(1 - theta(4)))/(theta(4) - 1)).*exp(-xs.^(1 - theta(4))/(theta(4) - 1)).^(theta(4) - 3).*(theta(4) - 1).*(theta(4) - 2))/2 - (3.*theta(1).*theta(3).^2.*theta(4).*exp(-(2.*xs.^(1 - theta(4)))/(theta(4) - 1)).*(theta(2) - exp(-xs/(xs.^theta(4).*(theta(4) - 1)))).*(theta(4) + 1))/exp(-xs.^(- theta(4) + 1)/(theta(4) - 1)).^(theta(4) + 2) + (theta(3).^4.*theta(4).*exp(-(3.*xs.^(1 - theta(4)))/(theta(4) - 1)).*exp(-xs.^(1 - theta(4))/(theta(4) - 1)).^(theta(4) - 4).*(theta(4) - 1).*(theta(4) - 2).*(theta(4) - 3))/2 + (theta(1).*theta(3).^2.*theta(4).*exp(-(3.*xs.^(1 - theta(4)))/(theta(4) - 1)).*(theta(2) - exp(-xs/(xs.^theta(4).*(theta(4) - 1)))).*(theta(4) + 1).*(theta(4) + 2))/exp(-xs.^(- theta(4) + 1)/(theta(4) - 1)).^(theta(4) + 3)))/187500000))/(theta(3).*x.^theta(4).*xs.^theta(4).*(theta(4) - 1)) + 1))/(5644425081792261.*theta(3).*x.^theta(4))
[y, fval, ste] = mle(f, X_data, Xs_data, [2, 2, 2, 0.5])
